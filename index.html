<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moonlight Cravings | Live Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        :root { --pink: #fce4ec; --rose-gold: #b76e79; --plum: #4a148c; --white: #ffffff; --soft-pink: #fff1f5; }
        body { margin: 0; font-family: 'Georgia', serif; background: var(--pink); color: var(--plum); }
        nav { background: var(--white); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top:0; z-index:100; box-shadow: 0 2px 10px rgba(183,110,121,0.1); }
        .nav-links button { background: none; border: none; font-weight: bold; color: var(--rose-gold); cursor: pointer; margin-left: 20px; }
        .container { max-width: 1100px; margin: auto; padding: 20px; }
        .card { background: var(--white); padding: 20px; border-radius: 25px; text-align: center; margin-bottom: 20px; box-shadow: 0 8px 15px rgba(0,0,0,0.05); }
        .btn { background: var(--rose-gold); color: white; border: none; padding: 14px; width: 100%; border-radius: 30px; cursor: pointer; font-weight: bold; font-size: 1rem; }
        #checkout-modal { display: none; position: fixed; inset: 0; background: rgba(74, 20, 140, 0.8); z-index: 1000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content { background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 400px; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid var(--pink); border-radius: 12px; background: var(--soft-pink); box-sizing: border-box; }
    </style>
</head>
<body>

<div id="checkout-modal">
    <div class="modal-content">
        <h2 style="color:var(--rose-gold)">Delivery Details ðŸšš</h2>
        <input type="text" id="cust-name" placeholder="Full Name">
        <input type="email" id="cust-email" placeholder="Gmail">
        <input type="text" id="cust-phone" placeholder="Phone Number (e.g. 9876543210)">
        <textarea id="cust-address" placeholder="Full Delivery Address"></textarea>
        <button class="btn" onclick="finalizeOrder()">Confirm & Message Bakers</button>
        <button onclick="closeModal()" style="background:none; border:none; color:grey; width:100%; margin-top:10px; cursor:pointer;">Cancel</button>
    </div>
</div>

<nav>
    <div style="font-weight: bold; color: var(--rose-gold); font-size: 1.4rem;">ðŸŒ™ MOONLIGHT</div>
    <div class="nav-links">
        <button onclick="location.reload()">Menu</button>
    </div>
</nav>

<div class="container">
    <div class="card">
        <h3>Classic Vanilla</h3>
        <p>â‚¹800</p>
        <button class="btn" onclick="openCheckout('Classic Vanilla', 800)">Buy Now</button>
    </div>

    <div class="card" style="border: 2px dashed var(--rose-gold);">
        <h3>Custom Craving Request</h3>
        <textarea id="cust-desc" placeholder="Describe your dream cake (flavor, theme, size)..."></textarea>
        <button class="btn" style="margin-top:10px;" onclick="submitCustom()">Send to Bakers</button>
    </div>
</div>

<script>
    // PASTE YOUR FIREBASE CONFIG FROM STEP 1 HERE
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "YOUR_ID",
        appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let currentItem = "";
    let currentPrice = 0;

    function openCheckout(item, price) {
        currentItem = item;
        currentPrice = price;
        document.getElementById('checkout-modal').style.display = 'flex';
    }

    function submitCustom() {
        const desc = document.getElementById('cust-desc').value;
        if(!desc) return alert("Describe your cake first!");
        currentItem = "Custom: " + desc;
        currentPrice = 0;
        document.getElementById('checkout-modal').style.display = 'flex';
    }

    function closeModal() { document.getElementById('checkout-modal').style.display = 'none'; }

    async function finalizeOrder() {
        const name = document.getElementById('cust-name').value;
        const email = document.getElementById('cust-email').value;
        const phone = document.getElementById('cust-phone').value;
        const address = document.getElementById('cust-address').value;

        if(!name || !phone || !address) return alert("Please fill Name, Phone, and Address!");

        const orderData = {
            name, email, phone, address,
            item: currentItem,
            price: currentPrice,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        };

        try {
            // 1. Save to Cloud Vault
            await db.collection("orders").add(orderData);

            // 2. WhatsApp Bot Redirect (+91 [number] format)
            const cleanPhone = phone.replace(/\D/g, ''); 
            const whatsappMsg = `Hello Moonlight Cravings! My name is ${name}. I just ordered: ${currentItem}. Delivery Address: ${address}`;
            const waUrl = `https://wa.me/91${cleanPhone}?text=${encodeURIComponent(whatsappMsg)}`;
            
            alert("Order Saved! Redirecting to WhatsApp...");
            window.open(waUrl, '_blank');
            location.reload();
        } catch (e) {
            alert("Error sending order. Please check your Firebase rules.");
        }
    }
</script>
</body>
</html>
