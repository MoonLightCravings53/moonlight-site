<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Moonlight Vault | Owner Management</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        :root { --pink: #fce4ec; --rose-gold: #b76e79; --plum: #4a148c; --white: #ffffff; }
        body { background: var(--pink); color: var(--plum); font-family: 'Georgia', serif; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: auto; }
        h1 { color: var(--rose-gold); text-align: center; border-bottom: 2px solid white; padding-bottom: 10px; }
        
        .order-card { background: white; padding: 20px; border-radius: 20px; margin-bottom: 20px; border-left: 10px solid var(--rose-gold); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .info-box { background: #fff1f5; padding: 10px; border-radius: 10px; font-size: 0.9rem; border: 1px solid var(--pink); }
        .label { font-weight: bold; color: var(--rose-gold); display: block; font-size: 0.75rem; text-transform: uppercase; }
        
        .address-box { background: #fdfdfd; border: 1px dashed var(--rose-gold); padding: 12px; border-radius: 10px; margin-top: 10px; }
        .request-box { background: #4a148c; color: white; padding: 15px; border-radius: 10px; margin: 10px 0; }
        
        .price-controls { display: flex; gap: 10px; align-items: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; }
        input[type="number"] { padding: 10px; border-radius: 10px; border: 1px solid #ddd; width: 120px; }
        .btn-send { background: #2ecc71; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        .status-badge { margin-left: auto; font-weight: bold; padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Moonlight Live Orders üåô</h1>
        <div id="orders-list">
            <p style="text-align:center; opacity:0.5;">Connecting to cloud vault...</p>
        </div>
    </div>

    <script>
        // PASTE THE SAME FIREBASE CONFIG FROM YOUR INDEX.HTML HERE
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_ID",
            appId: "YOUR_APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Real-time listener for orders
        function listenForOrders() {
            db.collection("orders").orderBy("timestamp", "desc").onSnapshot((snapshot) => {
                const list = document.getElementById('orders-list');
                
                if (snapshot.empty) {
                    list.innerHTML = "<p style='text-align:center; opacity:0.5;'>No orders found yet.</p>";
                    return;
                }

                list.innerHTML = snapshot.docs.map(doc => {
                    const o = doc.data();
                    const docId = doc.id;
                    const date = o.timestamp ? o.timestamp.toDate().toLocaleString() : "Processing...";
                    
                    return `
                        <div class="order-card">
                            <div class="detail-grid">
                                <div class="info-box"><span class="label">Customer</span>${o.name}</div>
                                <div class="info-box"><span class="label">Phone</span>${o.phone}</div>
                                <div class="info-box"><span class="label">Gmail</span>${o.email}</div>
                                <div class="info-box"><span class="label">Time</span>${date}</div>
                            </div>

                            <div class="address-box">
                                <span class="label">üìç Delivery Address</span>
                                ${o.address}
                            </div>

                            <div class="request-box">
                                <span class="label" style="color: #fce4ec;">üç∞ Item / Request</span>
                                <strong>${o.item}</strong>
                            </div>

                            <div class="price-controls">
                                <span class="label">Set Price (‚Çπ):</span>
                                <input type="number" id="price-${docId}" value="${o.price || ''}" placeholder="0">
                                <button class="btn-send" onclick="updatePrice('${docId}')">Update Quote</button>
                                <span class="status-badge" style="background: ${o.status === 'paid' ? '#e8f5e9; color: #2e7d32;' : '#fff3e0; color: #ef6c00;'}">
                                    ${o.status.toUpperCase()}
                                </span>
                            </div>
                        </div>
                    `;
                }).join('');
            }, (error) => {
                console.error("Firebase Error: ", error);
                document.getElementById('orders-list').innerHTML = "<p style='color:red;'>Error loading orders. Check Firebase Rules.</p>";
            });
        }

        async function updatePrice(docId) {
            const newPrice = document.getElementById(`price-${docId}`).value;
            if(!newPrice) return alert("Enter a price first!");

            try {
                await db.collection("orders").doc(docId).update({
                    price: Number(newPrice),
                    status: 'priced'
                });
                alert("Price updated! Customer can now see this in their inbox.");
            } catch (e) {
                alert("Error updating price: " + e.message);
            }
        }

        // Start listening when page loads
        window.onload = listenForOrders;
    </script>
</body>
</html>

